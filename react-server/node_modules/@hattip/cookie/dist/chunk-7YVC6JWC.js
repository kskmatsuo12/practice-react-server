// src/serialize.ts
import "@hattip/compose";
import { serialize } from "cookie";
function cookieSerializer(defaultOptions) {
  return async function serializeCookie(ctx) {
    ctx.outgoingCookies = [];
    ctx.setCookie = (name, value, options) => {
      ctx.outgoingCookies.push({
        name,
        value,
        options: { ...defaultOptions, ...options }
      });
    };
    ctx.deleteCookie = (name, options) => {
      ctx.outgoingCookies.push({
        name,
        value: "",
        options: {
          ...defaultOptions,
          ...options,
          maxAge: 0
        }
      });
    };
    const response = await ctx.next();
    for (const { name, value, options } of ctx.outgoingCookies) {
      response.headers.append("set-cookie", serialize(name, value, options));
    }
    return response;
  };
}

export {
  cookieSerializer
};
